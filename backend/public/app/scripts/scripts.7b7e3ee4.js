$(function(){$("#side-menu").metisMenu()}),$(function(){$(window).bind("load resize",function(){topOffset=50,width=this.window.innerWidth>0?this.window.innerWidth:this.screen.width,width<768?($("div.navbar-collapse").addClass("collapse"),topOffset=100):$("div.navbar-collapse").removeClass("collapse"),height=(this.window.innerHeight>0?this.window.innerHeight:this.screen.height)-1,height-=topOffset,height<1&&(height=1),height>topOffset&&$("#page-wrapper").css("min-height",height+"px")});var a=window.location,b=$("ul.nav a").filter(function(){return this.href==a||0==a.href.indexOf(this.href)}).addClass("active").parent().parent().addClass("in").parent();b.is("li")&&b.addClass("active")}),angular.module("chetApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).constant("API_URL","http://curso-angular-api.app/api").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/users",{templateUrl:"views/users.html",controller:"UsersCtrl"}).when("/users/new",{templateUrl:"views/users-form.html",controller:"UsersCtrl"}).when("/users/edit/:id",{templateUrl:"views/users-form.html",controller:"UsersCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/products",{templateUrl:"views/products.html",controller:"ProductsCtrl"}).when("/terms",{templateUrl:"views/terms.html",controller:"TermsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("chetApp").controller("MainCtrl",["$scope","AuthService",function(a,b){b.isLoggedIn({attempt:"/"},function(){})}]),angular.module("chetApp").controller("UsersCtrl",["$scope","$location","$sce","$routeParams","AuthService","UserService","PaginationService",function(a,b,c,d,e,f,g){e.isLoggedIn({attempt:"users"},function(){a.user={},a.loading=!1,a.itemsPerPage=9,a.currentPage=1,a.pagination={},a.paginationRange=16,a.prevPage=function(){window.console.log(a.currentPage),a.currentPage>1&&(a.currentPage--,a.fetch())},a.nextPage=function(){a.currentPage<a.pagination.last_page&&(a.currentPage++,a.fetch())},a.setPage=function(){a.currentPage=this.page,a.fetch()},a.filterCitiesHandler=function(){void 0!==a.filterCities&&(a.currentPage=1,a.fetch())},a.filterOrderByHandler=function(){void 0!==a.orderBy&&(a.currentPage=1,a.fetch())},a.voltar=function(){b.path("users")},a.save=function(d){d.$valid&&f.saveUser(a.user).success(function(c){c.success&&(a.user={},a.fetch(),b.path("users"))}).error(function(b){if(b.errors){a.serverSideValidationErrors="<strong>Mensagem do servidor:</strong><br>";for(var d in b.errors)a.serverSideValidationErrors+="&bull; "+b.errors[d]+"<br>";a.serverSideValidationErrors=c.trustAsHtml(a.serverSideValidationErrors)}})},a["new"]=function(){a.user={},b.path("users/new")},a.edit=function(c){a.user=c,b.path("users/edit/"+c.id)},a.remove=function(b){var c=window.confirm("Tem certeza que deseja excluir "+b.fullname);c&&f.removeUser(b).success(function(b){b.success&&a.fetch()})},a.fetch=function(){var b={cities:a.filterCities,orderBy:a.filterOrderBy,limit:a.itemsPerPage,page:a.currentPage};a.loading=!0,f.getUsers(b).success(function(b){a.users=b.users,a.loading=!1,a.pagination=b.pagination,a.range=g.generatePagesArray(a.currentPage,a.pagination.total,a.itemsPerPage,a.paginationRange)})};var e=function(){d.id?(a.loading=!0,f.getUser(d.id).success(function(b){a.user=b.user,a.loading=!1})):a.fetch()};e()})}]),angular.module("chetApp").controller("LoginCtrl",["$scope","AuthService",function(a,b){a.email="vedovelli@gmail.com",a.password="123456",a.remember=!0,a.login=function(){b.login(a.email,a.password,a.remember)}}]),angular.module("chetApp").service("AuthService",["$http","$location",function(a,b){var c=this;this.isLoggedIn=function(d,e){var f=JSON.parse(window.localStorage.getItem("chet"));void 0!==f.token&&(c.token=f.token,a.defaults.headers.common.Authorization="Basic "+c.token),c.request=d,void 0===c.token?b.path("login"):e()},this.login=function(d,e,f){a.post("http://curso-angular-api.app/login",{email:d,password:e}).success(function(d){if(c.token=d.token,f){var e={token:c.token};window.localStorage.setItem("chet",JSON.stringify(e))}a.defaults.headers.common.Authorization="Basic "+c.token,b.path(void 0!==c.request?c.request.attempt:"/")})},this.logout=function(){c.token=void 0,c.request=void 0;var d={token:c.token};window.localStorage.setItem("chet",JSON.stringify(d)),a.defaults.headers.common.Authorization=void 0,b.path("login")}}]),angular.module("chetApp").controller("AppCtrl",["$scope","AuthService",function(a,b){a.auth=b,a.$watch("auth.token",function(b){a.token=b}),a.logout=function(){b.logout()}}]),angular.module("chetApp").controller("ProductsCtrl",["$scope","AuthService","ProductService",function(a,b,c){b.isLoggedIn({attempt:"products"},function(){var b=c.Product;a.loading=!1,a.novo=function(){b.save({name:"Novo nome de produto",country:"Brazil"});d()},a.atualizar=function(a){var c=a.name;a.name=c+"Z",b.update({productId:a.id},a)},a.remover=function(a){b.remove({productId:a},function(){d()})};var d=function(){a.loading=!0,a.products=b.query(function(){a.loading=!1})};d()})}]),angular.module("chetApp").controller("TermsCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("chetApp").service("UserService",["$http","API_URL",function(a,b){this.getUsers=function(c){return a.get(b+"/user?limit="+encodeURIComponent(c.limit)+"&page="+encodeURIComponent(c.page)+"&cities="+encodeURIComponent(c.cities)+"&orderBy="+encodeURIComponent(c.orderBy))},this.saveUser=function(c){return void 0===c.id?a.post(b+"/user",c):a.put(b+"/user/"+c.id,c)},this.removeUser=function(c){return a["delete"](b+"/user/"+c.id)},this.getUser=function(c){return a.get(b+"/user/"+c)}}]),angular.module("chetApp").directive("chetSelect2",["CityService",function(a){return{restrict:"A",link:function(b,c,d){var e={};void 0!==d.allowclear&&(e.allowClear=d.allowclear),d.source&&a.getCities(d.source).success(function(a){var b="";a.data.forEach(function(a){b+='<option value="'+a[d.property]+'">'+a[d.property]+"</option>"}),c.html(b)}),c.select2(e)}}}]),angular.module("chetApp").directive("chetUserCard",function(){return{templateUrl:"views/directives/chet-user-card.html",restrict:"E",link:function(a){a.showControls=!1,a.toggleControls=function(b){a.showControls=b}}}}),angular.module("chetApp").service("CityService",["$http",function(a){this.getCities=function(b){return a.get(b)}}]),angular.module("chetApp").directive("chetModal",["ChetModalService",function(a){return{templateUrl:"views/directives/chet-modal.html",restrict:"E",replace:!0,transclude:!0,scope:{title:"@",closeButton:"="},link:function(b,c){a.set(c)}}}]),angular.module("chetApp").service("ModalService",function(){}),angular.module("chetApp").service("ChetModalService",function(){this.set=function(a){this.modalElement=a},this.open=function(){this.modalElement.modal("show")},this.close=function(){this.modalElement.modal("hide")}}),angular.module("chetApp").service("PaginationService",function(){this.generatePagesArray=function(a,b,c,d){var e,f=[],g=Math.ceil(b/c),h=Math.ceil(d/2);e=h>=a?"start":a>g-h?"end":"middle";for(var i=g>d,j=1;g>=j&&d>=j;){var k=this.calculatePageNumber(j,a,d,g),l=2===j&&("middle"===e||"end"===e),m=j===d-1&&("middle"===e||"start"===e);f.push(i&&(l||m)?"...":k),j++}return f},this.calculatePageNumber=function(a,b,c,d){var e=Math.ceil(c/2);return a===c?d:1===a?a:d>c?b>d-e?d-c+a:b>e?b-e+a:a:a}}),angular.module("chetApp").directive("chetPagination",function(){return{templateUrl:"views/directives/chet-pagination.html",restrict:"E"}}),angular.module("chetApp").service("ProductService",["$resource","API_URL",function(a,b){this.Product=a(b+"/product/:productId",{productId:"@id"},{update:{method:"PUT"}})}]);